// Generated by CoffeeScript 1.3.3
(function() {

  App.config(function($routeProvider) {
    return $routeProvider.when("/", {
      templateUrl: 'tasks-template',
      controller: 'TasksController',
      reloadOnSearch: false
    });
  });

  App.controller('TasksController', function($scope, $routeParams, Task) {
    var setTasks;
    setTasks = function() {
      var match;
      return $scope.tasks = (match = String($routeParams.state).match(/(current|done)/)) ? Task[match[0]]() : Task.all();
    };
    setTasks();
    $scope.$on('$routeUpdate', function() {
      return setTasks();
    });
    $scope.$watch('tasks', function(changes) {
      _.each(changes, function(task) {
        return Task.update(_.pick(task, 'id', 'description', 'complete'));
      });
      $scope.taskCount = Task.all().length;
      return $scope.incompleteCount = Task.where({
        complete: false
      }).length;
    }, true);
    $scope.classFor = function(task) {
      if (task.complete) {
        return 'complete';
      }
    };
    $scope.taskSorter = function(task) {
      return "" + task.complete + task.description;
    };
    return $scope.nukeAllTasks = function() {
      Task.clear();
      return $scope.tasks = Task.all();
    };
  });

  App.controller('NewTaskController', function($scope, Task) {
    $scope.clearCompletedTasks = function() {
      _.each(Task.where({
        complete: true
      }), function(task) {
        return Task.destroy(task);
      });
      return $scope.$parent.$parent.tasks = Task.all();
    };
    $scope.clearAllTasks = function() {
      return $scope.$parent.$parent.tasks = Task.clear();
    };
    return $scope.addTask = function(taskForm, task) {
      if (taskForm.$valid) {
        Task.create(task);
        $scope.task = {};
        return $scope.$parent.$parent.tasks = Task.all();
      }
    };
  });

}).call(this);
